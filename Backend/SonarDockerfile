# Use the official OpenJDK 17 image as the base image
FROM node:latest

# Install necessary packages
RUN apk add --no-cache curl git openssh-client

# Install Node.js from NodeSource
RUN apk add --no-cache --virtual .build-deps curl && \
    curl -fsSL https://deb.nodesource.com/setup_18.x | bash - && \
    apk add --no-cache nodejs npm && \
    apk del .build-deps

# Install nodemon and bcrypt globally
RUN npm install -g nodemon bcrypt

# Download and install SonarScanner
RUN curl -Lo /tmp/sonar-scanner-cli.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472.zip && \
    unzip /tmp/sonar-scanner-cli.zip -d /opt && \
    rm /tmp/sonar-scanner-cli.zip && \
    ln -s /opt/sonar-scanner-4.6.2.2472/bin/sonar-scanner /usr/bin/sonar-scanner

# Set environment variables
ENV PATH="/opt/sonar-scanner-4.6.2.2472/bin:${PATH}"

# Verify installations
RUN sonar-scanner --version
RUN node -v && npm -v